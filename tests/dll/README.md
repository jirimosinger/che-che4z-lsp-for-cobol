# Creating shared library and DLL

This directory contains a very simple C source which can be used to test shared library of the COBOL LS server generated by GraalVM.

## Prerequisites

There are few prerequisites before the shared library can be created:

- The COBOL LS project needs to be build first and `server/engine/target/server.jar` needs to exist
- GraalVM needs to be available on the system

## Steps for creating shared library on Linux

### Generating GraalVM artifacts

Under Linux, the GraalVM artifacts (generated files) can be created using the following commands:

```sh
mkdir tests/dll/artifacts
cd tests/dll/artifacts
native-image -jar ../../../server/engine/target/server.jar --shared -o libcobol_ls_server
```

### Building main.c

GraalVM specific compiler flavor must be used to build `main.c` with the following command:

```sh
cd ../src
mv ../artifacts/libcobol_ls_server.so ../bin/libcobol_ls_server.so
mv ../artifacts/* .
~/bin/graalvm-ce-java11-22.3.3/languages/llvm/native/bin/clang -I ./ -L ../bin/ -l cobol_ls_server -Wl,-rpath ./ -o ../bin/main main.c
```

## Running main

The `main` executable needs to be in the same directory as the shared library created in [Generating GraalVM artifacts](#generating-graalvm-artifacts):

```sh
cd ../bin
./main
```
